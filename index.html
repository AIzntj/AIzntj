<!-- login.html -->
<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>é˜¿å…­æ™ºèƒ½ç»Ÿè®¡ - ç™»å½•</title><style>*{box-sizing:border-box;margin:0;padding:0;font-family:"PingFang SC","Microsoft YaHei",sans-serif}body{background-color:#f5f5f5;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:15px;color:#333}.login-container{background-color:#fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1);width:100%;max-width:450px;overflow:hidden}.login-header{background:linear-gradient(135deg,#2c3e50 0%,#3498db 100%);color:#fff;padding:20px;text-align:center}.login-header h1{font-size:1.5rem;margin-bottom:5px}.login-header p{opacity:.9;font-size:14px}.login-content{padding:20px}.input-group{margin-bottom:20px}.input-group label{display:block;margin-bottom:5px;font-weight:bold;color:#2c3e50;font-size:14px}.input-group input{width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;font-size:16px;transition:border .3s}.input-group input:focus{border-color:#3498db;outline:0}.login-btn{width:100%;padding:10px;background-color:#2ecc71;color:#fff;border:0;border-radius:5px;font-size:16px;cursor:pointer;transition:background-color .3s;font-weight:bold}.login-btn:hover{background-color:#27ae60}.device-info{background-color:#f8f9fa;border-radius:5px;padding:15px;margin:15px 0;border-left:4px solid #3498db}.device-info h4{color:#2c3e50;margin-bottom:10px;font-size:14px}.device-info p{color:#666;font-size:13px;margin-bottom:5px}.status-info{background-color:#e8f4fc;border-radius:5px;padding:10px;margin-top:15px;font-size:14px;text-align:center}.error-message{background-color:#ffebee;color:#c62828;padding:10px;border-radius:5px;margin-top:15px;display:none;font-size:14px}.user-note{font-size:12px;color:#666;margin-top:15px;text-align:center;padding:8px;background-color:#f8f9fa;border-radius:5px}.wechat-info{background:linear-gradient(135deg,#09bb07 0%,#09bb07 100%);color:#fff;padding:10px;border-radius:5px;margin-top:15px;text-align:center;font-weight:bold}@media (max-width:768px){body{padding:10px;align-items:flex-start;padding-top:30px}.login-container{max-width:100%}.login-header{padding:15px}.login-header h1{font-size:1.3rem}.login-header p{font-size:13px}.login-content{padding:15px}.input-group{margin-bottom:15px}.input-group label{font-size:13px}.input-group input{padding:8px;font-size:15px}.login-btn{padding:12px;font-size:15px}.device-info{padding:12px;margin:12px 0}.device-info h4{font-size:13px}.device-info p{font-size:12px}.status-info{font-size:13px;padding:8px}.error-message{font-size:13px;padding:8px}.user-note{font-size:11px;padding:6px}.wechat-info{padding:8px;font-size:14px}}@media (max-width:480px){.login-header h1{font-size:1.2rem}.login-header p{font-size:12px}.input-group input{padding:8px;font-size:14px}.login-btn{padding:10px;font-size:14px}.device-info{padding:10px}.device-info h4{font-size:12px}.device-info p{font-size:11px}.status-info{font-size:12px}.error-message{font-size:12px}.user-note{font-size:10px}.wechat-info{font-size:12px}}</style></head><body><div class=login-container><div class=login-header><h1>é˜¿å…­æ™ºèƒ½ç»Ÿè®¡</h1><p>è¯·è¾“å…¥å¯†ç ç™»å½•ç³»ç»Ÿ</p></div><div class=login-content><div class=input-group><label>ç™»å½•å¯†ç ï¼š</label><input type=password id=passwordInput placeholder="è¾“å…¥æ‚¨çš„ä¸“å±å¯†ç " autocomplete=off></div><div class=device-info><h4>ğŸ“± å½“å‰è®¾å¤‡ä¿¡æ¯</h4><p id=devicePlatform>ç³»ç»Ÿï¼šæ­£åœ¨æ£€æµ‹...</p><p id=deviceBrowser>æµè§ˆå™¨ï¼šæ­£åœ¨æ£€æµ‹...</p></div><button class=login-btn onclick=a()>ğŸš€ ç™»å½•ç³»ç»Ÿ</button><div class=wechat-info>å¯†ç è¯·è”ç³»é˜¿å…­å¾®ä¿¡ aizntj</div><div class=status-info id=accountStatus></div><div class=error-message id=errorMessage></div><div class=user-note id=userNote></div></div></div><script src=https://unpkg.com/@supabase/supabase-js@2></script><script>const b='https://mzsuaimcgphlcfrenrwg.supabase.co',c='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16c3VhaW1jZ3BobGNmcmVucndnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NTA4OTYsImV4cCI6MjA4MDMyNjg5Nn0.Hf1Q6JQ-KHfmh58BIjDgzBTS5DVIQxXbnIKXfjKPQg4';let d=window.supabase.createClient(b,c);function e(){let a={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screen:`${window.screen.width}x${window.screen.height}`,timezone:new Date().getTimezoneOffset(),hardwareConcurrency:navigator.hardwareConcurrency||'unknown',deviceMemory:navigator.deviceMemory||'unknown',cookiesEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack||'unknown'},b=JSON.stringify(a),c=0;for(let d=0;d<b.length;d++){let a=b.charCodeAt(d);c=((c<<5)-c)+a,c=c&c}return c.toString()}function f(){let a=navigator.userAgent,b=navigator.platform,c="æœªçŸ¥æµè§ˆå™¨";a.includes("Chrome")&&!a.includes("Edg")?c="Chrome":a.includes("Firefox")?c="Firefox":a.includes("Safari")&&!a.includes("Chrome")?c="Safari":a.includes("Edg")&&(c="Edge"),a.includes("Mac")?b="Mac":a.includes("Win")?b="Windows":a.includes("Linux")?b="Linux":a.includes("Android")?b="Android":(a.includes("iPhone")||a.includes("iPad"))&&(b="iOS"),document.getElementById('devicePlatform').textContent=`ç³»ç»Ÿï¼š${b}`,document.getElementById('deviceBrowser').textContent=`æµè§ˆå™¨ï¼š${c}`}async function a(){let a=document.getElementById('passwordInput').value.trim(),b=e();if(!a)return void g('è¯·è¾“å…¥å¯†ç ');let h=document.querySelector('.login-btn'),i=h.textContent;h.textContent='æ­£åœ¨éªŒè¯...',h.disabled=!0;try{let{data:j,error:k}=await d.from('users').select('*').eq('password_hash',btoa(a)).single();if(k||!j)return void g('å¯†ç é”™è¯¯æˆ–è´¦æˆ·ä¸å­˜åœ¨');if('active'!==j.status)return void g(`è´¦æˆ·çŠ¶æ€ï¼š${'inactive'===j.status?'å·²åœç”¨':'å·²è¿‡æœŸ'}`);if(j.expire_date){let a=new Date(j.expire_date),b=new Date;if(a<b){await d.from('users').update({status:'expired'}).eq('password_hash',btoa(a));return void g('è´¦æˆ·å·²è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜ç»­æœŸ')}let c=Math.ceil((a-b)/(1e3*60*60*24));l(`è´¦æˆ·æœ‰æ•ˆæœŸå‰©ä½™ï¼š${c}å¤©`)}else l('è´¦æˆ·çŠ¶æ€ï¼šæ°¸ä¹…æœ‰æ•ˆ');let{data:m,error:n}=await d.from('devices').select('*').eq('password_hash',btoa(a));if(!n){if(m.length>=j.max_devices){let d=m.find(d=>d.device_fingerprint===b);if(!d)return void g(`è®¾å¤‡æ•°é‡è¶…é™ï¼ˆæœ€å¤š${j.max_devices}å°ï¼‰ï¼Œè¯·è”ç³»ç®¡ç†å‘˜`)}let o=m.find(d=>d.device_fingerprint===b);o||await d.from('devices').insert({password_hash:btoa(a),device_fingerprint:b,device_name:navigator.platform})}await d.from('users').update({last_login:new Date().toISOString(),login_count:(j.login_count||0)+1}).eq('password_hash',btoa(a));await d.from('usage_logs').insert({password_hash:btoa(a),action:'login',user_agent:navigator.userAgent});localStorage.setItem('auth_token',btoa(`${btoa(a)}:${b}`)),localStorage.setItem('user_password_hash',btoa(a)),localStorage.setItem('user_display_name',j.display_name||'ç”¨æˆ·'),localStorage.setItem('login_time',Date.now().toString()),j.note&&(document.getElementById('userNote').textContent=`ç”¨æˆ·å¤‡æ³¨ï¼š${j.note}`),setTimeout(()=>{window.location.href='main.html'},500)}catch(a){console.error('ç™»å½•é”™è¯¯ï¼š',a),g('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•')}finally{h.textContent=i,h.disabled=!1}}function g(a){let b=document.getElementById('errorMessage');b.textContent=a,b.style.display='block',setTimeout(()=>{b.style.display='none'},5e3)}function l(a){document.getElementById('accountStatus').innerHTML=`<p>âœ… ${a}</p>`}async function m(){let a=localStorage.getItem('auth_token');if(a)try{let[b,c]=atob(a).split(':'),{data:d}=await window.supabase.createClient(b,'').from('users').select('*').eq('password_hash',b).single();if(d&&'active'===d.status){let{data:a}=await window.supabase.createClient(b,'').from('devices').select('*').eq('password_hash',b).eq('device_fingerprint',c);a&&a.length>0&&(l('æ£€æµ‹åˆ°å·²ç™»å½•çŠ¶æ€ï¼Œæ­£åœ¨è·³è½¬...'),setTimeout(()=>{window.location.href='main.html'},1500))}}catch(a){localStorage.removeItem('auth_token'),localStorage.removeItem('user_password_hash')}}window.addEventListener('load',function(){f(),m(),document.getElementById('passwordInput').addEventListener('keypress',function(a){'Enter'===a.key&&login()})});</script></body></html>